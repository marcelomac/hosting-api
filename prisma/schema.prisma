generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Moviment {
  id             String        @id @default(cuid())
  number         String        @unique
  employeeId     String
  departmentId   String?
  relationshipId String?
  ordinanceId    String?
  movimentType   String
  date           DateTime
  origin         String
  annotation     String?
  status         String
  statusDate     DateTime      @default(now())
  compliance     Boolean       @default(false)
  createdAt      DateTime      @default(now())
  role           String?
  Email          Email[]
  Department     Department?   @relation(fields: [departmentId], references: [id], onDelete: Restrict)
  Employee       Employee      @relation(fields: [employeeId], references: [id])
  Ordinance      Ordinance?    @relation(fields: [ordinanceId], references: [id], onDelete: Restrict)
  Relationship   Relationship? @relation(fields: [relationshipId], references: [id], onDelete: Restrict)
  Script         Script[]
}

model Employee {
  id        String      @id @default(cuid())
  name      String
  cpf       String      @unique
  login     String?
  sex       String
  phone     String
  email     String
  password  String?
  birthdate DateTime?
  createdAt DateTime    @default(now())
  Moviment  Moviment[]
  Ordinance Ordinance[]
}

model Department {
  id            String      @id @default(cuid())
  name          String
  folderPath    String?
  description   String?
  instructions  String?
  phone         String?
  ldapGroupName String?
  ldapGroupOU   String?
  active        Boolean     @default(true)
  Moviment      Moviment[]
  Ordinance     Ordinance[]
}

model Relationship {
  id                   String                 @id @default(cuid())
  name                 String
  description          String?
  active               Boolean                @default(true)
  Moviment             Moviment[]
  ResourceRelationship ResourceRelationship[]
}

model Resource {
  id                   String                 @id @default(cuid())
  name                 String
  description          String?
  active               Boolean                @default(true)
  ResourceRelationship ResourceRelationship[]
  Template             Template[]
}

model ResourceRelationship {
  id             String       @id @default(cuid())
  resourceId     String
  relationshipId String
  createdAt      DateTime     @default(now())
  active         Boolean      @default(true)
  Relationship   Relationship @relation(fields: [relationshipId], references: [id])
  Resource       Resource     @relation(fields: [resourceId], references: [id])
}

model User {
  id        String    @id @default(cuid())
  name      String
  login     String    @unique
  password  String?
  email     String    @unique
  role      String
  active    Boolean   @default(true)
  createdAt DateTime  @default(now())
  Profile   Profile?
  UserLog   UserLog[]
}

model Profile {
  id              String  @id @default(cuid())
  theme           String
  avatarUrl       String
  userId          String  @unique
  openTableFilter Boolean @default(false)
  User            User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Setting {
  id                                  String  @id @default(cuid())
  movimentCreateToDismissal           Boolean @default(false)
  movimentCreateToIngress             Boolean @default(false)
  ordinanceStartDateConfig            String  @default("lastFetch")
  ordinanceStartDaysBefore            Int     @default(3)
  robotActionsActiveSchedule          Boolean @default(false)
  robotActionsScheduleContent         String?
  robotFetchOrdinanceActiveSchedule   Boolean @default(false)
  robotFetchOrdinanceScheduleContent  String?
  scriptExecuteEmailSendAfterCreate   Boolean @default(false)
  scriptExecuteRequestAfterCreate     Boolean @default(false)
  scriptExecuteWebscrapingAfterCreate Boolean @default(false)
  scriptRemovePendingBeforeCreate     Boolean @default(false)
  scriptCreateAfterRevisedMoviment    Boolean @default(false)
  scriptExecuteCreateEmailAfterCreate Boolean @default(false)
  keywordsToDismissal                 String? @default("")
  keywordsToEndLicense                String? @default("")
  keywordsToEndSuspension             String? @default("")
  keywordsToEndVacation               String? @default("")
  keywordsToIngress                   String? @default("")
  keywordsToStartLicense              String? @default("")
  keywordsToStartSuspension           String? @default("")
  keywordsToStartVacation             String? @default("")
  movimentCreateToEndLicense          Boolean @default(false)
  movimentCreateToEndSuspension       Boolean @default(false)
  movimentCreateToEndVacation         Boolean @default(false)
  movimentCreateToStartLicense        Boolean @default(false)
  movimentCreateToStartSuspension     Boolean @default(false)
  movimentCreateToStartVacation       Boolean @default(false)
  ordinanceSendEmailDestiny           String?
  ordinanceSendEmailToDismissal       Boolean @default(false)
  ordinanceSendEmailToEndLicense      Boolean @default(false)
  ordinanceSendEmailToEndSuspension   Boolean @default(false)
  ordinanceSendEmailToEndVacation     Boolean @default(false)
  ordinanceSendEmailToIngress         Boolean @default(false)
  ordinanceSendEmailToStartLicense    Boolean @default(false)
  ordinanceSendEmailToStartSuspension Boolean @default(false)
  ordinanceSendEmailToStartVacation   Boolean @default(false)
}

model Ordinance {
  id             String      @id @default(cuid())
  publication    DateTime
  ordinanceType  String
  number         String      @unique
  content        String
  link           String      @default("")
  status         String      @default("pending")
  employeeName   String?
  departmentName String?
  createdAt      DateTime    @default(now())
  departmentId   String?
  employeeId     String?
  ordinanceUrl   String?
  Moviment       Moviment[]
  Department     Department? @relation(fields: [departmentId], references: [id])
  Employee       Employee?   @relation(fields: [employeeId], references: [id])
}

model Script {
  id            String   @id @default(cuid())
  movimentId    String
  templateId    String
  number        String   @unique
  scriptContent String
  emailContent  String?
  status        String
  statusDate    DateTime
  scriptType    String
  annotation    String?
  createdAt     DateTime @default(now())
  Moviment      Moviment @relation(fields: [movimentId], references: [id])
  Template      Template @relation(fields: [templateId], references: [id])
}

model Email {
  id         String    @id @default(cuid())
  movimentId String
  to         String
  cc         String?
  cco        String?
  subject    String
  preview    String?
  text       String?
  html       String
  sentAt     DateTime?
  status     String
  createdAt  DateTime  @default(now())
  uniqueKey  String    @unique
  scriptId   String
  Moviment   Moviment  @relation(fields: [movimentId], references: [id])
}

model Template {
  id            String   @id @default(cuid())
  name          String
  order         Int
  resourceId    String
  movimentType  String
  scriptType    String
  scriptContent String
  emailContent  String?
  sendEmail     Boolean  @default(false)
  createdAt     DateTime @default(now())
  Script        Script[]
  Resource      Resource @relation(fields: [resourceId], references: [id])
}

model UserLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  message   String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id])
}

model SysLog {
  id        String   @id @default(cuid())
  action    String
  message   String
  file      String
  createdAt DateTime @default(now())
}
